let success_rate=[50,45,45,40,40,40,35,35,35,35,30,30,30,30,30,30,30,30,30,30];function cal_exp(e,l){return 1.4*(1+l)*(10+e)}function find_lowest_Highest(l){if(0===l.length)return{lowest:null,highest:null};let r=l[0],t=l[l.length-1];for(let e=1;e<l.length;e++)l[e]<r&&(r=l[e]),l[e]>t&&(t=l[e]);return{lowest:r,highest:t}}self.onmessage=function(e){for(bundle=e.data.bundle,total_tries=0,curr_tries=0,total_used_proto=0,curr_used_proto=0,enhance_level=0,curr_em=0,curr_cost=0,r=0,s_tries=18<=bundle.stop_at?1276777:15<=bundle.stop_at?976777:13<=bundle.stop_at?16397:1639,all_result=e.data.all,avg_result=e.data.avg;curr_em<bundle.em;){for(curr_em++,enhance_level=bundle.start_at,curr_tries=0,curr_used_proto=0;enhance_level<bundle.stop_at;)total_tries++,curr_tries++,r=100*Math.random()+0,r<=Number((success_rate[enhance_level]*bundle.total_bonus+5e-4).toFixed(2))?bundle.use_blessing?(r=100*Math.random()+0,r<=1?(all_result.exp+=(cal_exp(bundle.item_level,enhance_level)+cal_exp(bundle.item_level,enhance_level+1))*bundle.wisdom,enhance_level+=2):(all_result.exp+=cal_exp(bundle.item_level,enhance_level)*bundle.wisdom,enhance_level++)):(all_result.exp+=cal_exp(bundle.item_level,enhance_level)*bundle.wisdom,enhance_level++):bundle.use_proto&&enhance_level>=bundle.proto_at?(total_used_proto++,curr_used_proto++,all_result.exp+=cal_exp(bundle.item_level,enhance_level)*bundle.wisdom*.1,enhance_level--):(all_result.exp+=cal_exp(bundle.item_level,enhance_level)*bundle.wisdom*.1,enhance_level=0),total_tries%s_tries==0&&self.postMessage({type:0,data:total_tries.toString()});all_result.tries+=curr_tries,all_result.used_proto+=curr_used_proto,all_result.mat_1+=curr_tries*bundle.mat_1,all_result.mat_2+=curr_tries*bundle.mat_2,all_result.mat_3+=curr_tries*bundle.mat_3,all_result.mat_4+=curr_tries*bundle.mat_4,all_result.mat_5+=curr_tries*bundle.mat_5,all_result.prc_1+=curr_tries*bundle.mat_1*bundle.prc_1,all_result.prc_2+=curr_tries*bundle.mat_2*bundle.prc_2,all_result.prc_3+=curr_tries*bundle.mat_3*bundle.prc_3,all_result.prc_4+=curr_tries*bundle.mat_4*bundle.prc_4,all_result.prc_5+=curr_tries*bundle.mat_5*bundle.prc_5,all_result.coins+=curr_tries*bundle.coins,all_result.time+=curr_tries*bundle.time,all_result.proto_prc+=curr_used_proto*bundle.proto_price,all_result.cost=all_result.prc_1+all_result.prc_2+all_result.prc_3+all_result.prc_4+all_result.prc_5+all_result.coins+all_result.proto_prc,curr_cost=curr_tries*bundle.mat_1*bundle.prc_1+curr_tries*bundle.mat_2*bundle.prc_2+curr_tries*bundle.mat_3*bundle.prc_3+curr_tries*bundle.mat_4*bundle.prc_4+curr_tries*bundle.mat_5*bundle.prc_5+curr_tries*bundle.coins+curr_used_proto*bundle.proto_price,(0==all_result.l_cost||curr_cost<all_result.l_cost)&&(all_result.l_cost=curr_cost,all_result.total_l_cost+=curr_cost,all_result.l_cost_div++),curr_cost>all_result.h_cost&&(all_result.h_cost=curr_cost,all_result.total_h_cost+=curr_cost,all_result.h_cost_div++),self.postMessage({type:1,data:curr_em})}for(key in avg_result)avg_result[key]=all_result[key]/all_result.em;avg_result.l_cost=all_result.total_l_cost/all_result.l_cost_div,avg_result.h_cost=all_result.total_h_cost/all_result.h_cost_div,self.postMessage({type:2,avg:avg_result,all:all_result})};